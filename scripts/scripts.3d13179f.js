"use strict";var app=angular.module("nohoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope",function(a){a.questions=[{id:"question1",name:"Should we hard fork?"},{id:"question2",name:"Is Ether awesome?"},{id:"question3",name:"Bro, do you even blockchain?"}]}]),app.controller("AboutCtrl",["$scope",function(a){}]);var Web3=require("web3"),web3=new Web3;web3.setProvider(new web3.providers.HttpProvider);var to="0x3B0C2BA7A03725E0f9aC5a55CB813823053d5eBE",connected=web3.isConnected();console.log("connected "+connected);var getBalance=web3.eth.getBalance(web3.eth.accounts[0]);app.directive("networkStats",["ethereum","$interval","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"/views/directives/networkStats.html",link:function(a){b(function(){c.pending||(a.sinceLastBlock<=20?a.syncState="good":a.sinceLastBlock>20&&a.sinceLastBlock<60?a.syncState="warning":a.syncState="bad",a.sinceLastBlock+=1)},1e3)}}}]),app.directive("accountSelector",["ethereum","ethSignalContract","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"/views/directives/accountSelector.html",link:function(d){var e=b;d.accounts=a.accounts,d.user={defaultAccount:"coinbase"},d.$watch("user.defaultAccount",function(b,c){console.log(e),c!=b&&(console.log("Setting defaultAccount to: ",b),a.web3.eth.defaultAccount=b)}),d.newProposal=function(){0==c.newProposals.length&&c.newProposals.push({name:"",description:""})}}}}]),app.directive("proposalsList",["proposalService","ethereum","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"/views/directives/proposalsList.html",link:function(d){d.proposals=a.proposals,d.newProposals=c.newProposals,d.percentage=function(a,b){return a+b},d.cancel=function(){c.newProposals=[]},d.vote=function(c,d){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert('Please select an account to from the "Select Account" dropdown.'):void a.vote(c,d)},d.createProposal=function(c){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert('Please select an account to from the "Select Account" dropdown.'):void a.newProposal(c)}}}}]),app.service("ethereum",["$rootScope","$interval",function(a,b){function c(a){var b=new Date(0);return b.setUTCSeconds(a),b.toString()}function d(a){return 1==a?"Main-Net":2==a?"Test-Net":void 0}function e(a){return a?"connected":"disconnected"}function f(a){return 1==a?"https://etherscan.io/tx":2==a?"https://testnet.etherscan.io/tx":void 0}a.pending=!0,a.syncState="warning",a.currentBlock="SYNCING",a.currentBlockTime="SYNCING",a.sinceLastBlock=0,connected&&(a.ethereumNetwork=d(web3.version.network),a.etherscanUrl=f(web3.version.network));var g=web3.isConnected();a.connectionStateDisplay=e(g),a.connectionState=g,b(function(){newState=web3.isConnected(),newState!=g&&location.reload()},7500);var h=null;return connected&&(!function(){var b=web3.eth.filter("latest");b.watch(function(b,d){web3.eth.getBlock(d,!1,function(b,d){a.pending=!1,a.currentBlock=d.number,a.currentBlockTime=c(d.timestamp),a.sinceLastBlock=-1})})}(),h=web3.eth.accounts),{web3:web3,accounts:h}}]),app.service("ethSignalContract",["ethereum",function(a){var b=a.web3,c=[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"proposals",outputs:[{name:"name",type:"string",value:"Do you support the hard fork?"},{name:"description",type:"string",value:'"Decentralization without decentralized social responsibility is terrifying"\\n-Vlad Zamfir'},{name:"creator",type:"address",value:"0xb2445f120a5a4fe73c4ca9b3a73f415371b5656b"},{name:"active",type:"bool",value:!0}],type:"function"},{constant:!0,inputs:[],name:"numberOfProposals",outputs:[{name:"_numberOfProposals",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"proposalID",type:"uint256"},{name:"position",type:"bool"}],name:"vote",outputs:[],type:"function"},{constant:!1,inputs:[{name:"proposalName",type:"string"},{name:"proposalDescription",type:"string"}],name:"newProposal",outputs:[],type:"function"},{inputs:[],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalID",type:"uint256"},{indexed:!1,name:"position",type:"bool"},{indexed:!1,name:"voter",type:"address"}],name:"userVotedEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalName",type:"string"},{indexed:!1,name:"proposalDescription",type:"string"},{indexed:!1,name:"creator",type:"address"}],name:"proposalCreatedEvent",type:"event"}];return b.eth.contract(c).at(to)}]),app.service("proposalService",["ethSignalContract","$q","ethereum","$rootScope",function(a,b,c,d){function e(a,b){var c=[];return c[0]=Math.round(100*a/(a+b)),c[1]=Math.round(100*b/(a+b)),c}if(connected){var f=[];d.newProposals=[];for(var g=0;g<a.numberOfProposals();g++){var h=a.proposals.call(g);h.push([]),h.push([]),h.push(0),h.push(0),f.push(h)}var i;return a.userVotedEvent({},{fromBlock:1187201,toBlock:"latest"}).get(function(a,b){console.log(b),i=b;for(var d in i){var g=i[d],h=g.args.proposalID.c[0],j=parseInt(web3.fromWei(c.web3.eth.getBalance(g.args.voter).toNumber(),"ether"),10);g.args.position?(f[h][4].push(g),f[h][6]+=j):(f[h][5].push(g),f[h][7]+=j);var k=e(f[h][6],f[h][7]);f[h][10]=k}}),{proposals:f,votes:i,percentage:function(a){console.log(out)},vote:function(e,f){var g=(b.defer(),c.web3.eth.defaultAccount);try{d.lastTx=a.vote(e,f)}catch(h){var i=prompt("Please enter your passphrase: "),j=c.web3.personal.unlockAccount(g,i);if(!j)throw alert("Incorrect passphrase"),h;console.log(g," unlocked."),d.lastTx=a.vote(e,f),console.log(d.lastTx),c.web3.personal.lockAccount(g),console.log(g," locked."),console.log("Voted ",f," on proposal: ",e)}},newProposal:function(b){from=c.web3.eth.defaultAccount;var e=a.newProposal.getData(b.name,b.description),f=c.web3.eth.estimateGas({from:from,to:to,data:e});try{d.lastTx=proposalService.contract.newProposal.sendTransaction(b.name,b.description,{from:from,to:to,gas:f})}catch(g){var h=prompt("Please enter your passphrase: ");console.log(from),console.log(h),console.log(c.web3.personal.unlockAccount(from,h));var i=c.web3.personal.unlockAccount(from,h);if(!i)throw alert("Incorrect passphrase"),g;console.log(from," unlocked."),d.lastTx=a.newProposal.sendTransaction(b.name,b.description,{from:from,to:to,gas:f}),console.log(d.lastTx),c.web3.personal.lockAccount(from),console.log(from," locked.")}d.newProposals=[]}}}return null}]);