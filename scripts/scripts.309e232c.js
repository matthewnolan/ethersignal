"use strict";function registerPosition(){}var app=angular.module("nohoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope",function(a){a.questions=[{id:"question1",name:"Should we hard fork?"},{id:"question2",name:"Is Ether awesome?"},{id:"question3",name:"Bro, do you even blockchain?"}]}]),app.controller("AboutCtrl",["$scope",function(a){}]);var isMist="undefined"!=typeof web3;if("undefined"!=typeof web3&&"undefined"!=typeof Web3)web3=new Web3(web3.currentProvider);else if("undefined"!=typeof Web3)web3=new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));else if("undefined"==typeof web3&&"undefined"==typeof Web3){var Web3=require("web3");web3=new Web3(new Web3.providers.HttpProvider("htts://signal.ether.ai/proxy"))}var to="0x3B0C2BA7A03725E0f9aC5a55CB813823053d5eBE",connected=web3.isConnected();console.log("connected "+connected),app.directive("networkStats",["ethereum","$interval","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"/views/directives/networkStats.html",link:function(a){b(function(){c.pending||(a.sinceLastBlock<=20?a.syncState="good":a.sinceLastBlock>20&&a.sinceLastBlock<60?a.syncState="warning":a.syncState="bad",a.sinceLastBlock+=1)},1e3)}}}]),app.directive("accountSelector",["ethereum","ethSignalContract","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"/views/directives/accountSelector.html",link:function(d){var e=b;d.accounts=a.accounts,d.user={defaultAccount:"coinbase"},d.$watch("user.defaultAccount",function(b,c){console.log(e),c!=b&&(console.log("Setting defaultAccount to: ",b),a.web3.eth.defaultAccount=b)}),d.newProposal=function(){0==c.newProposals.length&&c.newProposals.push({name:"",description:""})}}}}]),app.directive("proposalsList",["proposalService","ethereum","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"/views/directives/proposalsList.html",link:function(d){d.proposals=a.proposals,d.newProposals=c.newProposals,d.percentage=function(a,b){return a+b},d.cancel=function(){c.newProposals=[]},d.vote=function(c,d){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert('Please select an account to from the "Select Account" dropdown.'):void a.vote(c,d)},d.createProposal=function(c){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert('Please select an account to from the "Select Account" dropdown.'):void a.newProposal(c)}}}}]),app.service("ethereum",["$rootScope","$interval",function(a,b){function c(a){var b=new Date(0);return b.setUTCSeconds(a),b.toString()}function d(a){return 1==a?"Main-Net":2==a?"Test-Net":void 0}function e(a){return a?"connected":"disconnected"}function f(a){return 1==a?"https://etherscan.io/tx":2==a?"https://testnet.etherscan.io/tx":void 0}a.pending=!0,a.syncState="warning",a.currentBlock="SYNCING",a.currentBlockTime="SYNCING",a.sinceLastBlock=0,connected&&(a.ethereumNetwork=d(web3.version.network),a.etherscanUrl=f(web3.version.network));var g=web3.isConnected();a.connectionStateDisplay=e(g),a.connectionState=g,b(function(){newState=web3.isConnected(),newState!=g&&location.reload()},7500);var h=null;return connected&&(!function(){var b=web3.eth.filter("latest");b.watch(function(b,d){web3.eth.getBlock(d,!1,function(b,d){a.pending=!1,a.currentBlock=d.number,a.currentBlockTime=c(d.timestamp),a.sinceLastBlock=-1})})}(),h=web3.eth.accounts),{web3:web3,accounts:h}}]),app.service("ethSignalContract",["ethereum",function(a){var b=a.web3,c=[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"proposals",outputs:[{name:"name",type:"string",value:"Do you support the hard fork?"},{name:"description",type:"string",value:'"Decentralization without decentralized social responsibility is terrifying"\\n-Vlad Zamfir'},{name:"creator",type:"address",value:"0xb2445f120a5a4fe73c4ca9b3a73f415371b5656b"},{name:"active",type:"bool",value:!0}],type:"function"},{constant:!0,inputs:[],name:"numberOfProposals",outputs:[{name:"_numberOfProposals",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"proposalID",type:"uint256"},{name:"position",type:"bool"}],name:"vote",outputs:[],type:"function"},{constant:!1,inputs:[{name:"proposalName",type:"string"},{name:"proposalDescription",type:"string"}],name:"newProposal",outputs:[],type:"function"},{inputs:[],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalID",type:"uint256"},{indexed:!1,name:"position",type:"bool"},{indexed:!1,name:"voter",type:"address"}],name:"userVotedEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalName",type:"string"},{indexed:!1,name:"proposalDescription",type:"string"},{indexed:!1,name:"creator",type:"address"}],name:"proposalCreatedEvent",type:"event"}];return b.eth.contract(c).at(to)}]),app.service("proposalService",["ethSignalContract","$q","ethereum","$rootScope",function(a,b,c,d){function e(a,b){var c=[];return c[0]=Math.round(100*a/(a+b)),c[1]=Math.round(100*b/(a+b)),c}if(connected){var f=[];d.newProposals=[];for(var g=0;g<a.numberOfProposals();g++){var h=a.proposals.call(g);h.push([]),h.push([]),h.push(0),h.push(0),f.push(h)}var i;return a.userVotedEvent({},{fromBlock:1187201,toBlock:"latest"}).get(function(a,b){console.log(b),i=b;for(var d in i){var g=i[d],h=g.args.proposalID.c[0],j=parseInt(web3.fromWei(c.web3.eth.getBalance(g.args.voter).toNumber(),"ether"),10);g.args.position?(f[h][4].push(g),f[h][6]+=j):(f[h][5].push(g),f[h][7]+=j);var k=e(f[h][6],f[h][7]);f[h][10]=k}}),{proposals:f,votes:i,percentage:function(a){console.log(out)},vote:function(e,f){var g=(b.defer(),c.web3.eth.defaultAccount);try{d.lastTx=a.vote(e,f)}catch(h){var i=prompt("Please enter your passphrase: "),j=c.web3.personal.unlockAccount(g,i);if(!j)throw alert("Incorrect passphrase"),h;console.log(g," unlocked."),d.lastTx=a.vote(e,f),console.log(d.lastTx),c.web3.personal.lockAccount(g),console.log(g," locked."),console.log("Voted ",f," on proposal: ",e)}},newProposal:function(b){from=c.web3.eth.defaultAccount;var e=a.newProposal.getData(b.name,b.description),f=c.web3.eth.estimateGas({from:from,to:to,data:e});try{d.lastTx=proposalService.contract.newProposal.sendTransaction(b.name,b.description,{from:from,to:to,gas:f})}catch(g){var h=prompt("Please enter your passphrase: ");console.log(from),console.log(h),console.log(c.web3.personal.unlockAccount(from,h));var i=c.web3.personal.unlockAccount(from,h);if(!i)throw alert("Incorrect passphrase"),g;console.log(from," unlocked."),d.lastTx=a.newProposal.sendTransaction(b.name,b.description,{from:from,to:to,gas:f}),console.log(d.lastTx),c.web3.personal.lockAccount(from),console.log(from," locked.")}d.newProposals=[]}}}return null}]);var isMist="undefined"!=typeof web3;if("undefined"!=typeof web3&&"undefined"!=typeof Web3)web3=new Web3(web3.currentProvider);else if("undefined"!=typeof Web3)web3=new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));else if("undefined"==typeof web3&&"undefined"==typeof Web3){var Web3=require("web3");web3=new Web3(new Web3.providers.HttpProvider("htts://signal.ether.ai/proxy"))}var ethersignalContract=web3.eth.contract([{constant:!1,inputs:[{name:"pro",type:"bool"}],name:"setSignal",outputs:[],type:"function"},{constant:!1,inputs:[],name:"endSignal",outputs:[],type:"function"},{inputs:[{name:"rAddr",type:"address"}],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"pro",type:"bool"},{indexed:!1,name:"addr",type:"address"}],name:"LogSignal",type:"event"},{anonymous:!1,inputs:[],name:"EndSignal",type:"event"}]),positionregistryContract=web3.eth.contract([{constant:!1,inputs:[{name:"title",type:"string"},{name:"text",type:"string"}],name:"registerPosition",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"regAddr",type:"address"},{indexed:!0,name:"sigAddr",type:"address"},{indexed:!1,name:"title",type:"string"},{indexed:!1,name:"text",type:"string"}],name:"LogPosition",type:"event"}]),positionregistry=positionregistryContract.at("0x0265a5b822625ca506c474912662617c394bbb66"),to="0x0265a5b822625ca506c474912662617c394bbb66",connected=web3.isConnected();app.directive("networkStats",["ethereum","$interval","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"views/directives/networkStats.html",link:function(a){b(function(){c.pending||(a.sinceLastBlock<=20?a.syncState="good":a.sinceLastBlock>20&&a.sinceLastBlock<60?a.syncState="warning":a.syncState="bad",a.sinceLastBlock+=1)},1e3)}}}]),app.directive("accountSelector",["ethereum","ethSignalContract","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"views/directives/accountSelector.html",link:function(d){var e=b;d.accounts=a.accounts,d.user={defaultAccount:"coinbase"},d.$watch("user.defaultAccount",function(b,c){console.log(e),c!=b&&(console.log("Setting defaultAccount to: ",b),a.web3.eth.defaultAccount=b)}),d.newProposal=function(){0==c.newProposals.length&&c.newProposals.push({name:"",description:""})}}}}]),app.directive("proposalsList",["proposalService","ethereum","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"views/directives/proposalsList.html",link:function(d){d.proposals=a.proposals,d.newProposals=c.newProposals,d.percentage=function(a,b){return a+b},d.cancel=function(){c.newProposals=[]},d.vote=function(c,d){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert('Please select an account to from the "Select Account" dropdown.'):void a.vote(c,d)},d.createProposal=function(c){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert("Cannot find an account."):void a.newProposal(c)}}}}]),app.service("ethereum",["$rootScope","$interval",function(a,b){function c(a){var b=new Date(0);return b.setUTCSeconds(a),b.toString()}function d(a){return 1==a?"Main-Net":2==a?"Test-Net":void 0}function e(a){return a?"connected":"disconnected"}function f(a){return 1==a?"https://etherscan.io/tx":2==a?"https://testnet.etherscan.io/tx":void 0}web3.eth.defaultAccount=web3.eth.accounts[0],a.pending=!0,a.syncState="warning",a.currentBlock="SYNCING",a.currentBlockTime="SYNCING",a.sinceLastBlock=0,connected&&(a.ethereumNetwork=d(web3.version.network),a.etherscanUrl=f(web3.version.network));var g=web3.isConnected();a.connectionStateDisplay=e(g),a.connectionState=g,b(function(){newState=web3.isConnected(),newState!=g&&location.reload()},7500);var h=null;connected&&(!function(){var b=web3.eth.filter("latest");b.watch(function(b,d){web3.eth.getBlock(d,!1,function(b,d){a.pending=!1,a.currentBlock=d.number,a.currentBlockTime=c(d.timestamp),a.sinceLastBlock=-1})})}(),h=web3.eth.accounts[0]);var h=web3.eth.accounts[0];return{web3:web3,accounts:h}}]),app.service("ethSignalContract",["ethereum",function(a){var b=a.web3,c=[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"proposals",outputs:[{name:"name",type:"string",value:"Do you support the hard fork?"},{name:"description",type:"string",value:'"Decentralization without decentralized social responsibility is terrifying"\\n-Vlad Zamfir'},{name:"creator",type:"address",value:"0xb2445f120a5a4fe73c4ca9b3a73f415371b5656b"},{name:"active",type:"bool",value:!0}],type:"function"},{constant:!0,inputs:[],name:"numberOfProposals",outputs:[{name:"_numberOfProposals",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"proposalID",type:"uint256"},{name:"position",type:"bool"}],name:"vote",outputs:[],type:"function"},{constant:!1,inputs:[{name:"proposalName",type:"string"},{name:"proposalDescription",type:"string"}],name:"newProposal",outputs:[],type:"function"},{inputs:[],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalID",type:"uint256"},{indexed:!1,name:"position",type:"bool"},{indexed:!1,name:"voter",type:"address"}],name:"userVotedEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalName",type:"string"},{indexed:!1,name:"proposalDescription",type:"string"},{indexed:!1,name:"creator",type:"address"}],name:"proposalCreatedEvent",type:"event"}];return b.eth.contract(c).at(to)}]);var allThings={};app.service("proposalService",["ethSignalContract","$q","ethereum","$rootScope",function(a,b,c,d){function e(a){var b=a.args.sigAddr;allThings[b]={},allThings[b].raw=a;var c=ethersignalContract.at(b);c.LogSignal({},{fromBlock:12e5}).get(function(c,d){c&&console.warn("warning"),allThings[b].sigList=d;var e={},f={};for(obj in d)d[obj].args.pro?(e[d[obj].args.addr]=1,f[d[obj].args.addr]=0):(e[d[obj].args.addr]=0,f[d[obj].args.addr]=1);g(e,f,a)})}function f(a,b){var c=[];return c[0]=Math.round(100*a/(a+b)),c[1]=Math.round(100*b/(a+b)),c}function g(a,b,c){var d=0,e=0;Object.keys(a).map(function(c){var d=web3.fromWei(web3.eth.getBalance(c));a[c]=a[c]*d,b[c]=b[c]*d}),Object.keys(a).map(function(b){d+=parseFloat(a[b])}),Object.keys(b).map(function(a){e+=parseFloat(b[a])});var g=f(d,e);h.push({title:c.args.title,desc:c.args.text,regAddr:c.args.regAddr,pro:Math.round(d),against:Math.round(e),percent:g,sigAddr:c.args.sigAddr}),console.log(h)}var h=[];return d.newProposals=[],positionregistry.LogPosition({},{fromBlock:12e5}).get(function(a,b){a&&console.warn();for(obj in b)e(b[obj])}),{proposals:h,percentage:function(a){console.log(out)},vote:function(a,b){console.log(a,b);var e=c.web3.eth.defaultAccount,f=ethersignalContract.at(a);try{d.lastTx=f.setSignal(b,{from:e})}catch(g){console.log("Error submitting signal"),console.log(g),alert("Error submitting signal")}},newProposal:function(a){console.log(c.web3.eth.defaultAccount),from=c.web3.eth.defaultAccount;var b=positionregistry.registerPosition.getData(a.name,a.description);console.log("data ",b);var e=c.web3.eth.estimateGas({from:from,to:to,data:b});console.log("gas: ",e);try{d.lastTx=positionregistry.registerPosition.sendTransaction(a.name,a.description,{from:from,to:to,gas:e})}catch(f){console.log("Error submitting position"),console.log(f),alert("Error submitting position")}d.newProposals=[]}}}]);